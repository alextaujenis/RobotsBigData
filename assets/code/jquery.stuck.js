(function(){!function(t){return t.fn.stuck=function(e){var o;return new(o=function(){function e(e,o){this.window=e,this.body=t("body"),this.loadElements(),this.calculateTopOffset(),this.isIOS()&&this.body.on({touchmove:function(t){return function(){return t.update()}}(this)}),this.window.scroll(function(t){return function(){return t.update()}}(this)),this.window.resize(function(t){return function(){return t.resize()}}(this)),this.update()}return e.prototype.elements=[],e.prototype.resizing=!1,e.prototype.isIOS=function(){return this._isIOS||(this._isIOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent))},e.prototype.resize=function(){this.resizing=!0,this.calculateTopOffset(),this.update()},e.prototype.loadElements=function(){var e,o,i,s,n,r,f,h,p,a,c;for(i=t(".stuck"),s=i.length,c=0;s--;){for(r=i.eq(c),c++,f=!1,o="",e=r.attr("class").split(/\s+/),h=t("<div/>"),a=e.length;a--;)n=e[a],"release"===n&&(f=!0,o=r.closest(".release-container")),"stuck"!==n&&"release"!==n&&h.addClass(n);h.height(r.outerHeight()).hide().css("background-color","transparent").insertBefore(r),p=r.offset().top-parseInt(r.css("margin-top")),this.elements.push({node:r,spacer:h,top:p,top_offset:0,fixed:!1,release:f,container:o,contained:!1})}},e.prototype.calculateTopOffset=function(){var t,e,o,i,s,n,r,f,h,p,a,c,d;for(r=[],n=this.elements.length,a=0;n--;)if(i=this.elements[a],a++,c=r.length,0===c)i.release||r.push([i]);else{for(t=!1;c--&&!t;)for(f=0,s=r[c],d=s.length;d--;)h=s[d],o=this.collide(h.node,i.node),o?(p=h.top_offset+h.node.outerHeight(!0),p>f&&(f=p),t=!0,e=null!=r[c+1]?c+1:-1):0===c&&(e=0);t?(i.top_offset=f,i.release||(e>=0?r[e].push(i):r.push([i]))):(i.top_offset=0,i.release||r[0].push(i))}},e.prototype.collide=function(t,e){var o,i;return o=t.offset().left,i=e.offset().left,o===i?!0:i>o?Math.floor(o)+t.width()>Math.ceil(i)?!0:!1:Math.floor(i)+e.width()>Math.ceil(o)?!0:!1},e.prototype.update=function(){var t,e,o;for(o=this.window.scrollTop(),e=this.elements.length;e--;)t=this.elements[e],this.resizing&&(t.fixed?t.top=t.spacer.offset().top-parseInt(t.spacer.css("margin-top")):t.top=t.node.offset().top-parseInt(t.node.css("margin-top")),t.fixed&&t.node.css({top:t.top_offset,left:t.spacer.offset().left,width:t.spacer.outerWidth()}),t.contained&&o>t.container.offset().top+t.container.height()-t.node.height()-t.top_offset&&t.node.css({position:"absolute",top:t.container.height()-t.node.height(),left:"",width:"","z-index":""})),t.fixed&&t.release&&!t.contained&&o>t.container.offset().top+t.container.height()-t.node.height()-t.top_offset&&(t.contained=!0,t.container.css("position","relative"),t.node.css({position:"absolute",top:t.container.height()-t.node.height(),left:"",width:"","z-index":""})),t.contained&&o<t.container.offset().top+t.container.height()-t.node.height()-t.top_offset&&(t.contained=!1,t.container.css("position",""),t.node.css({position:"fixed",top:t.top_offset,left:t.spacer.offset().left,width:t.spacer.outerWidth(),"z-index":99})),!t.fixed&&o>t.top-t.top_offset&&(t.fixed=!0,t.spacer.show(),t.node.css({position:"fixed",top:t.top_offset,left:t.spacer.offset().left,width:t.spacer.outerWidth(),"z-index":99})),t.fixed&&o<t.top-t.top_offset&&(t.fixed=!1,t.spacer.hide(),t.node.css({position:"relative",top:"",left:"",width:"","z-index":""}));this.resizing=!1},e.prototype.destroy=function(){var t;for(t=this.elements.length;t--;)this.elements[t].spacer.remove();this.window.unbind("scroll"),this.window.unbind("resize"),this.window=this.elements=null},e}())(this,e)}}(jQuery)}).call(this);