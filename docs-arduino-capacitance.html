<!DOCTYPE html><html lang="en"><head><title>Robots + Big Data: Arduino Capacitance Docs</title><meta name="description" content="An Arduino library for measuring relative capacitance and calculating a moving average result."><link href="assets/style/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="assets/style/shCore.css" rel="stylesheet" type="text/css"><link href="assets/style/shCoreDefault.css" rel="stylesheet" type="text/css"><link href="assets/style/shThemeDefault.css" rel="stylesheet" type="text/css"><link href="assets/style/style.css" rel="stylesheet" type="text/css"><link href="assets/style/docs.css" rel="stylesheet" type="text/css"><link href="assets/style/install.css" rel="stylesheet" type="text/css"><meta content="width=device-width initial-scale=1" name="viewport"></head><body><div id="top"></div><div class="top-nav-spacer1 stuck">&nbsp;</div><div class="top-nav-spacer2">&nbsp;</div><div class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button id="toggle" type="button" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="index.html" translate="no" class="navbar-brand">Robots + Big Data</a></div><!-- Collect the links for mobile toggling--><div id="navbar-collapse" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="install.html">Install</a></li><li><a href="docs-arduino.html">Docs</a></li><li><a href="github.html">GitHub</a></li><li><a href="#top" style="display:none;" class="back-to-top">BACK TO TOP</a></li></ul></div></div></div><div class="container-fluid"><div class="row"><div translate="no" class="hidden-xs col-sm-4 stuck"><div class="panel panel-default side-panel"><div class="panel-heading"><div class="panel-title"><a href="docs-arduino.html">Arduino Libraries</a></div></div><div class="panel-body"><h3>Components</h3><ul><li><a href="docs-arduino-button.html">Button</a></li><li><a href="docs-arduino-light.html">Light</a></li><li><a href="docs-arduino-motor.html">Motor</a></li><li><a href="docs-arduino-servo.html">Servo</a></li></ul><h3>Sensors</h3><ul><li><a href="docs-arduino-light-sensor.html">Light Sensor</a></li><li><a href="docs-arduino-water-sensor.html">Water Sensor</a></li><li><a href="docs-arduino-human-sensor.html">Human Sensor</a></li></ul><h3>Additional Libraries</h3><ul><li><a href="docs-arduino-timer.html">Timer</a></li><li><a href="docs-arduino-threshold.html">Threshold</a></li><li><a href="docs-arduino-capacitance.html">Capacitance</a></li></ul></div></div></div><div class="documentation col-sm-8"><ol class="breadcrumb stuck"><li><a href="index.html">Home</a></li><li><a href="docs-arduino.html">Arduino</a></li><li translate="no" class="active">Capacitance</li></ol><div class="jumbotron"><div class="stuck click-through"><div class="row jumbotron-header click-through"><div class="col-xs-12 text-right click-through"><span class="label label-info title-label">Arduino</span></div></div></div><div class="jumbotron-container"><h2 translate="no">Capacitance<small translate="yes">API DOCUMENTATION</small></h2><p>Measure change in capacitance.<small>v1.0.4</small></p><a href="#download" class="btn btn-success">Download</a>&nbsp;&nbsp;<a href="#example-wiring" class="btn btn-default">See Example</a>&nbsp;&nbsp;<a href="#public-methods" class="btn btn-default">Public Methods</a></div></div><div class="h3"><div id="overview" class="anchor"></div>Overview</div><p class="lead">Detect human presence and touch from behind several millimeters of material, or detect change in water levels from the outside of a plastic container. This library is meant to help&nbsp;<b>determine change in relative capacitance</b> for the reasons above, and not for calculating exact capacitance.</p><p class="lead">Relative capacitance is found by measuring how long it takes for an Arduino send-pin to charge a receive-pin to HIGH (in microseconds). Changes in the electrical field around a sensor connected to the receive pin (such as a human passing by, or water filling up, or a motor turning on) have a measurable impact on the amount of time it takes to charge the receive pin.</p><p class="lead">Many of these charge and discharge readings are taken, then averaged within the library to reduce variability and give a more clear answer of what the sensor is reading. This is done without delay so it only has a small impact on the main loop() performance. See the&nbsp;<a href="#example-setup">Example</a> below for help wiring and programming the Arduino with this library.</p><div class="h3"><div id="download" class="anchor"></div>Download</div><p>This library is part of a larger package that you can download to access<i> all</i> of the documented sensors,&nbsp;<i>or</i> you can use this library by itself.</p><ul><li><a href="https://github.com/alextaujenis/RBD_Capacitance/raw/master/extras/RBD_Capacitance.zip">Download Capacitance Library v1.0.4&nbsp;<div class="label label-warning zip-label">.zip</div></a> by itself, or</li><li><a href="install.html">Download All Sensor Libraries</a> with this library included, or</li><li><a href="https://github.com/alextaujenis/RBD_Capacitance">View Source on GitHub</a> with&nbsp;<a href="http://opensource.org/licenses/mit-license.php" class="dark-link">MIT license</a></li></ul><div class="h3"><div id="example-wiring" class="anchor"></div>Example Wiring</div><ol><li>Connect Arduino&nbsp;<span class="blue-wire">digital pin 2</span> to a&nbsp;<b>10Meg&#8486; resistor</b></li><li>Connect the other end of the&nbsp;<b>10Meg&#8486; resistor</b> to Arduino&nbsp;<span class="control-wire">digital pin 3</span></li><li>Connect Arduino&nbsp;<span class="control-wire">digital pin 3</span> to a piece of conductive material (aluminum foil)</li><li>Cover the conductive material with non-conductive material (tape)</li><li>Load the&nbsp;<a href="#example-sketch">Example Sketch</a> onto the Arduino</li><li>Open a serial connection at 115200 baud to see the reported values</li><li>Touch or move your hand by the sensor</li></ol><p><img src="assets/images/arduino-capacitance-wiring-diagram.png" alt="A piece of aluminum foil connected to a 10 Meg Ohm resistor that is bridged across Arduino digital pins 2 and 3." class="img-responsive"></p><div class="h3"><div id="example-sketch" class="anchor"></div>Example Sketch<span class="label label-info">Arduino</span><span class="label label-primary">C++</span></div><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[#include <RBD_Capacitance.h>

RBD::Capacitance cap_sensor(2, 3); // send, receive pins

void setup() {
  Serial.begin(115200);
}

void loop() {
  cap_sensor.update();

  if(cap_sensor.onChange()) {
    Serial.println(cap_sensor.getValue());
  }
}
]]></script></div><div class="h3"><div id="sensitivity" class="anchor"></div>Sensitivity</div><p>Sensitivity is how far away the sensor can detect things, or how much resolution you have to recognize change in the sensor readings.</p><ul><li><b>Increase Sensitivity</b> by&nbsp;<i>either</i> adding more resistors in series (20Meg, 30Meg, or more),&nbsp;<i>or</i> increase the surface area (size) of the piece of aluminum used as the sensor.</li><li><b>Decrease Sensitivity</b> by&nbsp;<i>either</i> lowering the amount of resitance (use only 1Meg or less),&nbsp;<i>or</i> decrease the surface area (size) of the piece of aluminum used as the sensor.</li></ul><div class="h3"><div id="variability" class="anchor"></div>Variability</div><p>Variability is how wildly the sensor readings fluctuate. This library helps adjust the variability by taking a moving average of many readings over time. This is done without delay so it has little impact on the main loop() performance.</p><ul><li><b>Less Variable</b> readings that don't fluctuate so quickly can be achieved by increasing the sample size:&nbsp;<a href="#setsamplesize" class="click-flash">setSampleSize(1000)</a>.</li><li><b>More Variable</b> readings that fluctuate quickly can be achieved by decreasing the sample size:&nbsp;<a href="#setsamplesize" class="click-flash">setSampleSize(10)</a>.</li></ul><div class="h3"><div id="public-methods" class="anchor"></div>Public Methods</div><p>You must continuously call&nbsp;<a href="#update" class="click-flash">update()</a> inside of loop() in order to use the<span class="label label-success">Real-Time</span> methods tagged below.</p><h4 translate="no" class="class-name"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[RBD::Capacitance
]]></script></h4><ul translate="no" class="public-methods"><li><a href="#constructor" class="click-flash">constructor(send_pin, receive_pin)</a></li><li class="divider"></li><li><a href="#setsamplesize" class="click-flash">.setSampleSize(value)</a></li><li class="divider"></li><li><a href="#update" class="click-flash">.update()</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call this method within loop() to use any Real-Time methods." class="label label-primary"><img src="assets/images/update.png" alt="Update"></span></li><li><a href="#start" class="click-flash">.start()</a><span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span></li><li><a href="#isfinished" class="click-flash">.isFinished()</a><span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span></li><li><a href="#getvalue" class="click-flash">.getValue()</a><span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span></li><li class="divider"></li><li><a href="#onchange" class="click-flash">.onChange()</a><span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span><span data-toggle="tooltip" data-placement="right" title="Event: Use this method to find when an event has been triggered." class="label label-default">Event</span></li></ul><div class="section"><div translate="no" class="method-name"><div id="constructor" class="anchor"></div>RBD::Capacitance constructor(send_pin, receive_pin)</div><p>Create a new capacitance sensor and pass in the Arduino pin numbers for the send and receive pins.</p><h5>EXAMPLE&nbsp;<span translate="no">SKETCH</span></h5><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[RBD::Capacitance cap_sensor(2 ,3);

void setup() {
  ...
}
]]></script></div></div><div class="section"><div translate="no" class="method-name"><div id="setsamplesize" class="anchor"></div><div class="light">cap_sensor</div>.setSampleSize(value)</div><p>Pass in an integer to change the number of readings taken to calculate a moving average&nbsp;<a href="#getvalue" class="click-flash">getValue()</a>. This can be called inside of setup() or also safely at runtime inside of loop().</p><ul><li><b>Decrease Variation</b> in readings by making this number larger: 1000</li><li><b>Increase Variation</b> in readings by making this number smaller: 10</li><li><b>Default Value</b>: 100</li></ul><h5>EXAMPLE&nbsp;<span translate="no">SKETCH</span></h5><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[void setup() {
  cap_sensor.setSampleSize(1000);
}
]]></script></div></div><div class="section"><div translate="no" class="method-name"><div id="update" class="anchor"></div><div class="light">cap_sensor</div>.update()<span data-toggle="tooltip" data-placement="right" title="You must continuously call this method within loop() to use any Real-Time methods." class="label label-primary"><img src="assets/images/update.png" alt="Update"></span></div><p>This must be call continuously from within the loop() to move the library along in real-time.</p><h5>EXAMPLE&nbsp;<span translate="no">SKETCH</span></h5><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[void loop() {
  cap_sensor.update();
}
]]></script></div></div><div class="section"><div translate="no" class="method-name"><div id="start" class="anchor"></div><div class="light">cap_sensor</div>.start()<span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span></div><p>Begin taking many readings and start adding up the moving average for&nbsp;<a href="#getvalue" class="click-flash">getValue()</a>.</p><h5>EXAMPLE&nbsp;<span translate="no">SKETCH</span></h5><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[void setup() {
  cap_sensor.start();
}

void loop() {
  cap_sensor.update();
}
]]></script></div></div><div class="section"><div translate="no" class="method-name"><div id="isfinished" class="anchor"></div><div class="light">cap_sensor</div>.isFinished()<span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span></div><p>Returns true if all readings have been taken and a moving average&nbsp;<a href="#getvalue" class="click-flash">getValue()</a> is ready. You must first call&nbsp;<a href="#start" class="click-flash">start()</a>  to begin the sampling process.</p><h5>EXAMPLE&nbsp;<span translate="no">SKETCH</span></h5><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[void setup() {
  cap_sensor.start();
}

void loop() {
  cap_sensor.update();

  if(cap_sensor.isFinished()) {
    ...
  }
}
]]></script></div></div><div class="section"><div translate="no" class="method-name"><div id="getvalue" class="anchor"></div><div class="light">cap_sensor</div>.getValue()<span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span></div><p>Returns an unsigned long of the moving average value for the capacitance reading (microseconds taken to charge the pin). This will only return a value after calling&nbsp;<a href="#start" class="click-flash">start()</a> and waiting until&nbsp;<a href="#isfinished" class="click-flash">isFinished()</a> has returned true.</p><h5>EXAMPLE&nbsp;<span translate="no">SKETCH</span></h5><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[void setup() {
  cap_sensor.start();
}

void loop() {
  cap_sensor.update();

  if(cap_sensor.isFinished()) {
    Serial.println(cap_sensor.getValue());
  }
}
]]></script></div></div><div class="section"><div translate="no" class="method-name"><div id="onchange" class="anchor"></div><div class="light">cap_sensor</div>.onChange()<span data-toggle="tooltip" data-placement="right" title="Real-Time: You must continuously call update() to use this method." class="label label-success">Real-Time</span><span data-toggle="tooltip" data-placement="right" title="Event: Use this method to find when an event has been triggered." class="label label-default">Event</span></div><p>This method will fire a single event and start taking another sensor reading each time the&nbsp;<a href="#getvalue" class="click-flash">getValue()</a> changes, mimicking the same process of creating a loop by calling&nbsp;<a href="#start" class="click-flash">start()</a> and&nbsp;<a href="#isfinished" class="click-flash">isFinished()</a> together, but with a simple syntax and a tighter time loop.</p><h5>EXAMPLE&nbsp;<span translate="no">SKETCH</span></h5><div translate="no"><script type="syntaxhighlighter" class="brush: arduino; gutter: false;"><![CDATA[void loop() {
  cap_sensor.update();

  if(cap_sensor.onChange()) {
    // code only runs once per event
    Serial.println(cap_sensor.getValue());
  }
}
]]></script></div></div></div></div></div><div class="navbar navbar-default navbar-footer"><div class="container-fluid"><div class="row"><div class="col-xs-12 text-center">&copy; 2015&nbsp;<a href="http://opensource.org/licenses/mit-license.php">MIT License</a></div></div></div></div><script src="assets/code/jquery.min.js"></script><script src="assets/code/bootstrap.min.js"></script><script src="assets/code/init_bootstrap.js"></script><script src="assets/code/back_to_top.js"></script><script src="assets/code/jquery.stuck.js"></script><script src="assets/code/init_jquery_stuck.js"></script><script src="assets/code/google_analytics.js"></script><script src="assets/code/inspectlet.js"></script><script src="assets/code/shCore.js"></script><script src="assets/code/shLegacy.js"></script><script src="assets/code/shAutoloader.js"></script><script src="assets/code/shBrushArduino.js"></script><script src="assets/code/shBrushBash.js"></script><script src="assets/code/shBrushJScript.js"></script><script src="assets/code/syntax_highlighter.js"></script><script src="assets/code/click_flash.js"></script><script src="assets/code/jquery.color.min.js"></script></body></html>