<!DOCTYPE html><html lang="en"><head><title>Robots + Big Data: Water Sensor Documentation</title><link href="assets/style/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="assets/style/shCore.css" rel="stylesheet" type="text/css"><link href="assets/style/shCoreDefault.css" rel="stylesheet" type="text/css"><link href="assets/style/shThemeDefault.css" rel="stylesheet" type="text/css"><link href="assets/style/style.css" rel="stylesheet" type="text/css"><link href="assets/style/docs.css" rel="stylesheet" type="text/css"><link href="assets/style/install.css" rel="stylesheet" type="text/css"><meta content="width=device-width initial-scale=1" name="viewport"></head><body><a name="top"></a><div class="top-nav-spacer1 stuck">&nbsp;</div><div class="top-nav-spacer2">&nbsp;</div><div class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button id="toggle" type="button" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false" class="navbar-toggle collapsed"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="index.html" class="navbar-brand">Robots + Big Data</a></div><!-- Collect the links for mobile toggling--><div id="navbar-collapse" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="install.html">Install</a></li><li><a href="docs-arduino.html">Docs</a></li><li><a href="github.html">GitHub</a></li><li><a href="#top" style="display:none;" class="back-to-top">BACK TO TOP</a></li></ul></div></div></div><div class="container-fluid"><div class="row"><div class="hidden-xs col-sm-4 stuck"><div class="panel panel-default side-panel"><div class="panel-heading"><div class="panel-title"><a href="docs-arduino.html">Arduino Libraries</a></div></div><div class="panel-body"><h3>Components & Sensors</h3><ul><li><a href="docs-arduino-light.html">Light</a><span data-toggle="tooltip" data-placement="left" title="Timer Dependency" class="badge pull-right">1</span></li><li><a href="docs-arduino-motor.html">Motor</a><span data-toggle="tooltip" data-placement="left" title="Timer Dependency" class="badge pull-right">1</span></li><li><a href="docs-arduino-human-sensor.html">Human Sensor</a><span data-toggle="tooltip" data-placement="left" title="Capacitance and Threshold Dependencies" class="badge pull-right">2</span></li><li><a href="docs-arduino-water-sensor.html">Water Sensor</a><span data-toggle="tooltip" data-placement="left" title="Capacitance and Threshold Dependencies" class="badge pull-right">2</span></li><li><a href="docs-arduino-light-sensor.html">Light Sensor</a></li></ul><h3>Additional Libraries</h3><ul><li><a href="docs-arduino-timer.html">Timer</a></li><li><a href="docs-arduino-threshold.html">Threshold</a></li><li><a href="docs-arduino-capacitance.html">Capacitance</a></li></ul></div></div></div><div class="documentation col-sm-8"><ol class="breadcrumb stuck"><li><a href="index.html">Home</a></li><li><a href="docs-arduino.html">Arduino</a></li><li class="active">Water Sensor</li><a href="https://github.com/alextaujenis/RobotsBigData/edit/gh-pages/src/templates/docs-arduino-water-sensor.jade" data-toggle="tooltip" data-placement="left" title="Edit this page on GitHub." class="pull-right edit-page">edit</a></ol><div class="jumbotron"><div class="stuck click-through"><div class="row jumbotron-header click-through"><div class="col-xs-12 text-right click-through"><span class="label label-info title-label">Arduino</span></div></div></div><div class="jumbotron-container"><h2>Water Sensor<small> API DOCUMENTATION</small></h2><p>Measure and calibrate water level sensors.<small>v1.0.2</small></p><a href="#download" class="btn btn-success">Download</a>&nbsp;&nbsp;<a href="#example-setup" class="btn btn-default">See Example</a>&nbsp;&nbsp;<a href="#public-methods" class="btn btn-default">Public Methods</a></div></div><h3><a name="overview"></a>Overview</h3><p class="lead">Measure and calibrate capacitance sensors to detect change in water levels from the outside of a plastic container. The example below uses a piece of aluminum foil, but you can attach the wire to anything conductive and calibrate the sensor accordingly.</p><p class="lead">This library measures relative capacitance so it is prone to interference. You can temporarily adjust the entire scale and then reset it when the capacitance disruption has stopped by using&nbsp;<a href="#setmodifier" class="click-flash">setModifier()</a> and&nbsp;<a href="#resetmodifier" class="click-flash">resetModifier()</a>. Look at the&nbsp;<a href="docs-arduino-capacitance.html">Capacitance Library</a> if you would like to know more about how capacitance is calculated.</p><h3><a name="download"></a>Download</h3><p>This library is part of a larger package that you can download to access<i> all</i> of the documented sensors,&nbsp;<i>or</i> you can use this library by itself with two dependencies.</p><p><ul><li><a href="https://github.com/alextaujenis/RBD_WaterSensor/raw/master/extras/RBD_WaterSensor.zip">Download Water Sensor Library v1.0.2&nbsp;<label class="label label-warning zip-label">.zip</label></a> by itself with the&nbsp;<a href="https://github.com/alextaujenis/RBD_Capacitance/raw/master/extras/RBD_Capacitance.zip" class="dark-link">Capacitance</a> and&nbsp;<a href="https://github.com/alextaujenis/RBD_Threshold/raw/master/extras/RBD_Threshold.zip" class="dark-link">Threshold</a> dependencies, or</li><li><a href="install.html">Download All Sensor Libraries</a> with this library and dependencies included, or</li><li><a href="https://github.com/alextaujenis/RBD_WaterSensor">View Source on GitHub</a> with&nbsp;<a href="http://opensource.org/licenses/mit-license.php" class="dark-link">MIT license</a></li></ul></p><h3><a name="example-setup"></a>Example Setup</h3><p><ol><li>Bridge a 10Meg Ohm resistor across the send (tx 1) and receive (rx 0) pins</li><li>Run a length of wire from the receive (rx 0) pin to a strip of aluminum foil</li><li>Tape the foil to the side of a water-tight non-conductive (plastic) container</li><li>Load up the example sketch and open a serial connection at 115200 baud</li><li>Pour water into the container and change the raw threshold values in the sketch to match the levels</li><li>Pour out the water, then compile and load the calibrated sketch back into the Arduino</li><li>Your water level is calibrated and ready to use</li></ol></p><h3><a name="example-sketch"></a>Example Sketch<span class="label label-info">Arduino</span><span class="label label-primary">C++</span></h3><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[#include <RBD_Capacitance.h>
#include <RBD_Threshold.h>
#include <RBD_WaterSensor.h>

RBD::WaterSensor water_sensor(1, 0, 3); // send, receive, level count

void setup() {
  Serial.begin(115200);
  water_sensor.setLevel(1, 120);
  water_sensor.setLevel(2, 154);
  water_sensor.setLevel(3, 187);
  water_sensor.setMaxLevel(220);
}

void loop() {
  water_sensor.update();

  if(water_sensor.onRawValueChange()) {
    Serial.print("Active Level: ");
    Serial.print(water_sensor.getActiveLevel());
    Serial.print("  ---  ");
    Serial.print("Raw Value: ");
    Serial.println(water_sensor.getRawValue());
  }
}]]></script><h3><a name="public-methods"></a>Public Methods</h3><p>You must continuously call&nbsp;<a href="#update" class="click-flash">update()</a> inside of loop() in order to use the<span class="label label-success">REAL-TIME</span> methods tagged below.</p><h4 class="class-name"><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[RBD::WaterSensor
]]></script></h4><ul class="public-methods"><li><a href="#constructor" class="click-flash">constructor(send_pin, receive_pin, level_count)</a></li><hr class="divider"><li><a href="#setsamplesize" class="click-flash">.setSampleSize(value)</a></li><li><a href="#setlevel" class="click-flash">.setLevel(index, raw_value)</a></li><li><a href="#setmaxlevel" class="click-flash">.setMaxLevel(raw_value)</a></li><li><a href="#setmodifier" class="click-flash">.setModifier(value)</a></li><li><a href="#resetmodifier" class="click-flash">.resetModifier()</a></li><hr class="divider"><li><a href="#update" class="click-flash">.update()</a><span data-toggle="tooltip" data-placement="right" title="This helps move real-time methods along." class="label label-primary">PROCESS REAL-TIME</span></li><li><a href="#getvalue" class="click-flash">.getValue()</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></li><li><a href="#getrawvalue" class="click-flash">.getRawValue()</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></li><li><a href="#getactivelevel" class="click-flash">.getActiveLevel()</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></li><li><a href="#isactivelevel" class="click-flash">.isActiveLevel(value)</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></li><hr class="divider"><li><a href="#onvaluechange" class="click-flash">.onValueChange()</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span><span data-toggle="tooltip" data-placement="right" title="Use this method to find when an event has been triggered." class="label label-default">EVENT</span></li><li><a href="#onrawvaluechange" class="click-flash">.onRawValueChange()</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span><span data-toggle="tooltip" data-placement="right" title="Use this method to find when an event has been triggered." class="label label-default">EVENT</span></li><li><a href="#onactivelevelchange" class="click-flash">.onActiveLevelChange()</a><span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span><span data-toggle="tooltip" data-placement="right" title="Use this method to find when an event has been triggered." class="label label-default">EVENT</span></li></ul><div class="section"><a name="constructor"></a><h4>RBD::WaterSensor constructor(send_pin, receive_pin, level_count)</h4><p>Pass in integers for the send and receive pins to create a new instance of this class, along with an integer for the total number of levels the water sensor will detect. Example: if you want to detect low, medium, and high levels then level_count should equal 3.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[RBD::WaterSensor water_sensor(1, 0, 3); // send, receive, level count

void setup() {
  ...
}
]]></script></div><div class="section"><a name="setsamplesize"></a><h4>water_sensor.setSampleSize(value)</h4><p>Pass in an integer to change the number of readings taken to calculate the moving average&nbsp;<a href="#getrawvalue" class="click-flash">getRawValue()</a>. This can be called inside of setup() or also safely at runtime inside of loop().</p><ul><li><b>Decrease Variation</b> in readings by making this number larger: 5000</li><li><b>Increase Variation</b> in readings by making this number smaller: 100</li><li><b>Default Value</b>: 1000</li></ul><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void setup() {
  water_sensor.setSampleSize(250);
}
]]></script></div><div class="section"><a name="setlevel"></a><h4>water_sensor.setLevel(index, raw_value)</h4><p>Provide an integer for the level index and a raw value from&nbsp;<a href="#getrawvalue" class="click-flash">getRawValue()</a>. The level index starts at one (it is not zero-based). You must also call&nbsp;<a href="#setmaxlevel" class="click-flash">setMaxLevel()</a> at the end to set an upper bounds of the last level.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void setup() {
  water_sensor.setLevel(1, 120);
  water_sensor.setLevel(2, 154);
  water_sensor.setLevel(3, 187);
}
]]></script></div><div class="section"><a name="setmaxlevel"></a><h4>water_sensor.setMaxLevel(raw_value)</h4><p>Provide an integer from&nbsp;<a href="#getrawvalue" class="click-flash">getRawValue()</a> to set the upper-bounds threshold of the last level.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void setup() {
  water_sensor.setMaxLevel(220);
}
]]></script></div><div class="section"><a name="setmodifier"></a><h4>water_sensor.setModifier(value)</h4><p>Provide a positive or negative integer to temporarily adjust the water sensor threshold scale. The default value is 0.</p><p><i>For example</i>; if you have calibrated the scale and turn on a motor near the sensor: all readings will need to be adjusted for the increased capacitance from the motor.<ul><li>If a running motor increases the difference in water sensor readings by a&nbsp;<a href="#getrawvalue" class="click-flash">getRawValue()</a> of +200</li><li>Call&nbsp;<a href="#setmodifier" class="click-flash">setModifier(-200)</a> on the water sensor when the motor turns on</li><li>All of the calibrated water sensor thresholds will adjust -200</li><li>The water sensor&nbsp;<a href="#getactivelevel" class="click-flash">getActiveLevel()</a> and&nbsp;<a href="#getvalue" class="click-flash">getValue()</a> will account for motor interference</li><li>Call&nbsp;<a href="#resetmodifier" class="click-flash">resetModifier()</a> on the water sensor when the motor shuts off</li></ul></p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  if(...) { // adjust when motor is on
    water_sensor.setModifier(-200);
  }
  else {
    water_sensor.resetModifier();
  }

  water_sensor.update();

  // still works as expected with interference
  if(water_sensor.onActiveLevelChange()) {
    ...
  }
}
]]></script></div><div class="section"><a name="resetmodifier"></a><h4>water_sensor.resetModifier()</h4><p>Changes the&nbsp;<a href="#setmodifier" class="click-flash">setModifier()</a> back to 0 and resets calibration of the water sensor threshold scale.</p><p><i>For example</i>; if you have calibrated the scale and turn on a motor near the sensor: all readings will need to be adjusted for the increased capacitance from the motor.<ul><li>If a running motor increases the difference in water sensor readings by a&nbsp;<a href="#getrawvalue" class="click-flash">getRawValue()</a> of +200</li><li>Call&nbsp;<a href="#setmodifier" class="click-flash">setModifier(-200)</a> on the water sensor when the motor turns on</li><li>All of the calibrated water sensor thresholds will adjust -200</li><li>The water sensor&nbsp;<a href="#getactivelevel" class="click-flash">getActiveLevel()</a> and&nbsp;<a href="#getvalue" class="click-flash">getValue()</a> will account for motor interference</li><li>Call&nbsp;<a href="#resetmodifier" class="click-flash">resetModifier()</a> on the water sensor when the motor shuts off</li></ul></p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  if(...) {
    water_sensor.setModifier(-200);
  }
  else { // reset when motor is off
    water_sensor.resetModifier();
  }

  water_sensor.update();

  // still works as expected with interference
  if(water_sensor.onActiveLevelChange()) {
    ...
  }
}
]]></script></div><div class="section"><a name="update"></a><h4>water_sensor.update()<span data-toggle="tooltip" data-placement="right" title="This helps move real-time methods along." class="label label-primary">PROCESS REAL-TIME</span></h4><p>Keep processing the readings and move this library along in real-time.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();
}
]]></script></div><div class="section"><a name="getvalue"></a><h4>water_sensor.getValue()<span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></h4><p>Returns the capacitance sensor reading after being adjusted with the value given to&nbsp;<a href="#setmodifier" class="click-flash">setModifier()</a>.</p><p>This will return&nbsp;<a href="#getrawvalue" class="click-flash">getRawValue()</a> if you have not used&nbsp;<a href="#setmodifier" class="click-flash">setModifier()</a> yet, or if you have called&nbsp;<a href="#resetmodifier" class="click-flash">resetModifier()</a>.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();

  if(water_sensor.onValueChange()) {
    Serial.println(water_sensor.getValue());
  }
}
]]></script></div><div class="section"><a name="getrawvalue"></a><h4>water_sensor.getRawValue()<span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></h4><p>Returns the raw capacitance sensor reading and ignores any value that has been passed to&nbsp;<a href="#setmodifier" class="click-flash">setModifier()</a>.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();

  if(water_sensor.onRawValueChange()) {
    Serial.println(water_sensor.getRawValue());
  }
}
]]></script></div><div class="section"><a name="getactivelevel"></a><h4>water_sensor.getActiveLevel()<span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></h4><p>Returns the current water level.<ul><li>0 means there is no water</li><li>1 means the water is touching the first level</li><li>2 means the water is touching the second level</li><li>n means the water is touching the nth level</li><li>sizeof(n) + 1 means the water is above the max level</li><li>-1 if the value was not found</li></ul></p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();

  if(water_sensor.onActiveLevelChange()) {
    Serial.println(water_sensor.getActiveLevel());
  }
}
]]></script></div><div class="section"><a name="isactivelevel"></a><h4>water_sensor.isActiveLevel(value)<span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span></h4><p>Provide an integer from 0 to 255 and this will return true if it's equal to the current&nbsp;<a href="#getactivelevel" class="click-flash">getActiveLevel()</a>.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();

  if(water_sensor.onActiveLevelChange()) {
    if(water_sensor.isActiveLevel(1)) {
      Serial.println("First level active");
    }
  }
}
]]></script></div><div class="section"><a name="onvaluechange"></a><h4>water_sensor.onValueChange()<span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span><span data-toggle="tooltip" data-placement="right" title="Use this method to find when an event has been triggered." class="label label-default">EVENT</span></h4><p>This method will return true once the sensor&nbsp;<a href="#getvalue" class="click-flash">getValue()</a> changes. It will then return false until the reading changes to a different value again.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();

  if(water_sensor.onValueChange()) {
    // code only runs once per event
    Serial.println(water_sensor.getValue());
  }
}
]]></script></div><div class="section"><a name="onrawvaluechange"></a><h4>water_sensor.onRawValueChange()<span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span><span data-toggle="tooltip" data-placement="right" title="Use this method to find when an event has been triggered." class="label label-default">EVENT</span></h4><p>This method will return true once the sensor&nbsp;<a href="#getrawvalue" class="click-flash">getRawValue()</a> changes. It will then return false until the reading changes to a different value again.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();

  if(water_sensor.onRawValueChange()) {
    // code only runs once per event
    Serial.println(water_sensor.getRawValue());
  }
}
]]></script></div><div class="section"><a name="onactivelevelchange"></a><h4>water_sensor.onActiveLevelChange()<span data-toggle="tooltip" data-placement="right" title="You must continuously call update() to use this method." class="label label-success">REAL-TIME</span><span data-toggle="tooltip" data-placement="right" title="Use this method to find when an event has been triggered." class="label label-default">EVENT</span></h4><p>This method will return true once the sensor&nbsp;<a href="#getactivelevel" class="click-flash">getActiveLevel()</a> changes. It will then return false until the level changes to a different value again.</p><h5>EXAMPLE SKETCH</h5><script type="syntaxhighlighter" class="brush: cpp; gutter: false;"><![CDATA[void loop() {
  water_sensor.update();

  if(water_sensor.onActiveLevelChange()) {
    // code only runs once per event
    Serial.println(water_sensor.getActiveLevel());
  }
}
]]></script></div></div></div></div><script src="assets/code/jquery.min.js"></script><script src="assets/code/bootstrap.min.js"></script><script src="assets/code/init_bootstrap.js"></script><script src="assets/code/back_to_top.js"></script><script src="assets/code/jquery.stuck.js"></script><script src="assets/code/init_jquery_stuck.js"></script><script src="assets/code/google_analytics.js"></script><script src="assets/code/inspectlet.js"></script><script src="assets/code/shCore.js"></script><script src="assets/code/shLegacy.js"></script><script src="assets/code/shAutoloader.js"></script><script src="assets/code/shBrushCpp.js"></script><script src="assets/code/shBrushBash.js"></script><script src="assets/code/shBrushJScript.js"></script><script src="assets/code/syntax_highlighter.js"></script><script src="assets/code/click_flash.js"></script><script src="assets/code/jquery.color.min.js"></script><div class="navbar navbar-default navbar-footer"><div class="container-fluid"><div class="row"><div class="col-xs-12 text-right">&copy; 2015&nbsp;<a href="http://opensource.org/licenses/mit-license.php">MIT License</a></div></div></div></div></body></html>